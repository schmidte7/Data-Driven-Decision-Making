---
title: "Case Study I"
author: "Emily Schmidt and Genta Menmeti"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Clear the database
rm(list=ls()) 
```

### Load Packages and Data

```{r libraries}
library(dplyr) 
library(ggplot2)
library(readr) # Imports Excel csv
library(naniar) # Missing values
library(tidyverse)
library(caret)

source("VIF.R")
```

```{r, echo=FALSE, include=TRUE, message=FALSE, warning=FALSE}
# Load data
helio <- read_csv("Case_Stud_ I.csv")
#View(Case_Stud_I)
```

### Data Exploration
```{r Data Exploration}
kable(head(helio)) %>% kable_classic() %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) %>%
  kable_styling(position = "center") # Use kable to design table

str(helio) # Structure of object/ Type of variables
dim(helio) # Dimensions of data
summary(helio) # Produce result summaries of all variables

# Number of unique values in each variable
sapply(helio, function(x) length(unique(x)))
```

```{r}
# Produce result summaries
CSUM <- data.frame(mean = sapply(helio[,2], mean,na.rm = T) 
                  ,median = sapply(helio[,2], median,na.rm = T)
                  ,min = sapply(helio[,2], min,na.rm = T)
                  ,max = sapply(helio[,2], max,na.rm = T)
                  ,sd = sapply(helio[,2], sd,na.rm = T))

colnames(CSUM) = c("Mean","Median","Min","Max","Standard Deviation")

kable(head(CSUM)) |> kable_classic() |> 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) |> 
  kable_styling(position = "center") # Use kable to design table
```

```{r}
histogram <- ggplot(gather(data = helio[2]),aes(x = value)) +
  geom_histogram(aes(y=..density..),bins = 10, color = "white", fill = "blue") + # Creates bin sizing & sets line color
  geom_density(alpha= .2, fill="#56B4E9") +
  facet_wrap(~key,scales = "free") + # Converting the graphs into panels
  ggtitle("Quantitative Variable Analysis") + # Title name
  ylab("Count") + xlab("Value") + # Label names
  theme_classic() # A classic theme, with x and y axis lines and no grid lines

histogram
```

```{r}
# Using ggplot to create a boxplot with various features
ggplot(data = helio, aes(x = "",y = manufacturing_cost)) + 
    geom_boxplot(fill = "lightblue", alpha=0.2, outlier.shape = 21, outlier.color = "black") +
    stat_boxplot(geom = 'errorbar', linetype=1, width=0.25) + 
    ylab("Manufacturing Cost") + # Label names
    theme_classic() # A classic theme, no grid lines
```


```{r Missing Values}
# Missing values analysis
gg_miss_var(helio) + ggtitle("Missing values")
```


## Question 1
Use an electronic spreadsheet to plot the data displayed in table 1 and draw a scatter plot (point diagram). Does the multiplicative learning model which assumes the following relationship: \(Y = AX^b\) apply to this data set? In our case \(Y\) are the average manufacturing cost of the last batch of 100 solar panels at Heliotronic in $ after having
produced a cumulative production of \(X\) solar panels. In the table \(X\) represents the column labeled total number of solar panels produced at Heliotronics. \(b\) is the experience parameter not to be confused with the learning rate. \(X\) is the price or cost of the first unit. Obviously \(Y = AX^b\) is not a linear relationship of the type that regression analysis can model \(Y = a + b_1x_1\). So the question now is to transform the data in order to get a linear relationship. Make an appropriate transformation of the data and redo the plot with the transformed data.
```{r ggpairs, fig.width = 6, fig.height = 5}
ggplot(helio, aes(number_of_solar_panels, manufacturing_cost) ) +
  geom_point()+
    geom_smooth() +
  ggtitle("Quantitative Scatterplot")
```


```{r}
attach(helio)
plot(number_of_solar_panels, manufacturing_cost)
```

```{r}
helio=helio |>  mutate(Log_number=log10(number_of_solar_panels))
helio=helio |>  mutate(Log_cost=log10(manufacturing_cost))
```

```{r}
ggplot(helio, aes(Log_number, Log_cost) ) +
  geom_point()+
    geom_smooth(method="lm")
```


## Question 2
Once you have answered the above questions, conduct a linear regression with the transformed data: Use `R` to estimate the regression model. Please interpret the results of the regression analysis! How well does the model explain the data? What is the learning rate that applies in this case?
```{r}
# Linear regression
lin_reg_helio = with(helio,lm(Log_number ~ Log_cost))
summary(lin_reg_helio)
```

## Question 3
Please use the experience curve estimate from the regression model to calculate the expected average manufacturing cost per solar panel for the 400 solar panels that would be produced. for Switzerland. *Hint*: estimate the average production cost per solar panel for 4700, 4800, 4900 and 5000 units and compute their mean.

```{r}
# predict the cost of manufacturing 4700, 4800, 4900, and 5000 solar panels
x <-  c(4700, 4800, 4900, 5000)
y_pred <- predict(lin_reg_helio, newdata = x)

# compute the mean of the predicted costs
mean_cost <- mean(y_pred)
mean_cost
```


## Question 4
Please calculate a 95% confidence interval for the average manufacturing cost per solar panel for the panels produced for Switzerland by using the lower and upper bounds of the confidence interval estimate for the experience parameter. You should calculate two extra regression equations for both limits and then calculate the expected average manufacturing cost per solar panel for the 400 solar panels that would be produced for Switzerland as in exercise 3.

```{r}
# Computing confidence intervals for one or more parameters in a fitted model
CI = confint(lin_reg_helio)
CI
```



